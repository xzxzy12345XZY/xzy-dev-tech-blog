{"version":3,"file":"index.js","sources":["../../src/node/locales.ts","../../src/node/utils.ts","../../src/node/alias.ts","../../src/node/compact.ts","../../src/node/plugin.ts"],"sourcesContent":["import type { WalineLocaleConfig } from \"../shared/index.js\";\n\n/**\n * Default locale config for Waline\n */\nexport const walineLocales: WalineLocaleConfig = {\n  \"/en/\": {\n    placeholder:\n      \"Write a comment here (Fill in the email address to receive an email notification when being replied)\",\n  },\n\n  \"/zh/\": {\n    placeholder: \"请留言。(填写邮箱可在被回复时收到邮件提醒)\",\n  },\n\n  \"/zh-tw/\": {\n    placeholder: \"請留言。(填寫信箱可在被回覆時收到郵件提醒)\",\n  },\n\n  \"/de/\": {\n    placeholder:\n      \"Schreibe ein Kommentar (Geben Sie die E-Mail-Adresse ein, um eine E-Mail-Benachrichtigung zu erhalten, wenn Sie eine Antwort erhalten)\",\n  },\n\n  \"/de-at/\": {\n    placeholder:\n      \"Schreibe ein Kommentar (Geben Sie die E-Mail-Adresse ein, um eine E-Mail-Benachrichtigung zu erhalten, wenn Sie eine Antwort erhalten)\",\n  },\n\n  \"/vi/\": {\n    placeholder:\n      \"Để lại bình luận (Điền địa chỉ email để nhận email thông báo khi được trả lời)\",\n  },\n\n  \"/uk/\": {\n    placeholder:\n      \"Напишіть тут коментар (введіть адресу електронної пошти, щоб отримувати сповіщення електронною поштою, коли буде відповідь)\",\n  },\n\n  \"/ru/\": {\n    placeholder:\n      \"Напишите комментарий здесь (Введите адрес электронной почты, чтобы получить уведомление по электронной почте при ответе)\",\n  },\n\n  \"/br/\": {\n    placeholder:\n      \"Escreva um comentário aqui (preencha com o endereço de email para receber notificações quando tiver alguma resposta)\",\n  },\n\n  \"/pl/\": {\n    placeholder:\n      \"Wpisz tutaj komentarz (wpisz adres e-mail, aby otrzymać powiadomienie e-mail, gdy otrzymasz odpowiedź)\",\n  },\n\n  \"/sk/\": {\n    placeholder:\n      \"Napíš svoj komentár (vlož svoj e-mail taktiež, aby si bol notifikovaný o odpovediach)\",\n  },\n\n  \"/fr/\": {\n    placeholder:\n      \"Écrivez votre commentaire ici (Inscrivez votre email afin de recevoir une notification en cas de réponse)\",\n  },\n\n  \"/es/\": {\n    placeholder:\n      \"Escriba un comentario aquí (Ingrese su correo electrónico para recibir una notificación en caso de respuesta)\",\n  },\n\n  \"/ja/\": {\n    placeholder:\n      \"伝言をどうぞ (メールアドレスを入力すると、返信があった際にメールでお知らせします。)\",\n  },\n\n  \"/tr/\": {\n    placeholder:\n      \"Buraya bir yorum yazın (Yanıtlandığında bir e-posta bildirimi almak için e-posta adresinizi girin)\",\n  },\n\n  \"/ko/\": {\n    placeholder:\n      \"댓글을 남겨주세요 (답글이 달렸을 때 이메일로 알림을 받으려면 이메일 주소를 입력하세요)\",\n  },\n\n  \"/fi/\": {\n    placeholder:\n      \"Kirjoita kommentti tähän (täytä sähköpostiosoite saadaksesi sähköposti-ilmoituksen vastauksesta)\",\n  },\n  \"/hu/\": {\n    placeholder:\n      \"Írj kommentet itt! (Töltsd ki az email címet, hogy értesítést kapj, amikor válaszolnak.)\",\n  },\n\n  \"/id/\": {\n    placeholder:\n      \"Tulis komentar di sini (Isi alamat email untuk menerima notifikasi jika komentar kamu telah dibalas orang lain)\",\n  },\n\n  \"/nl/\": {\n    placeholder:\n      \"Schrijf een opmerking hier (Vul je emailadres in om een email-notificatie te ontvangen wanneer er gereageerd wordt.\",\n  },\n};\n","import { createRequire } from \"node:module\";\n\nimport { getDirname, path } from \"@vuepress/utils\";\nimport { Logger, ensureEndingSlash } from \"vuepress-shared/node\";\n\nconst __dirname = getDirname(import.meta.url);\nconst require = createRequire(import.meta.url);\n\nexport const CLIENT_FOLDER = ensureEndingSlash(\n  path.resolve(__dirname, \"../client\"),\n);\n\nexport const COMMENT_PROVIDERS = [\"Artalk\", \"Giscus\", \"Waline\", \"Twikoo\"];\n\nexport const PLUGIN_NAME = \"vuepress-plugin-comment2\";\n\nexport const logger = new Logger(PLUGIN_NAME);\n\nexport const getPackage = (provider?: string): string | null => {\n  switch (provider) {\n    case \"Artalk\":\n      return \"artalk\";\n    case \"Twikoo\":\n      return \"twikoo\";\n    case \"Waline\":\n      return \"@waline/client\";\n\n    default:\n      return null;\n  }\n};\n\nexport const isInstalled = (pkg: string): boolean => {\n  try {\n    require.resolve(pkg);\n\n    return true;\n  } catch (error) {\n    return false;\n  }\n};\n","import { noopModule } from \"vuepress-shared/node\";\n\nimport { CLIENT_FOLDER, COMMENT_PROVIDERS, logger } from \"./utils.js\";\n\nexport const getProvider = (provider = \"None\"): string => {\n  if (COMMENT_PROVIDERS.includes(provider))\n    return `${CLIENT_FOLDER}components/${provider}.js`;\n\n  if (provider !== \"None\") logger.error(`Invalid provider: ${provider}`);\n\n  return noopModule;\n};\n","import { colors } from \"@vuepress/utils\";\n\nimport type { CommentPluginOptions } from \"./options.js\";\nimport { logger } from \"./utils.js\";\n\n/** @deprecated */\nexport const convertOptions = (\n  options: CommentPluginOptions & {\n    /** @deprecated */\n    type?: \"waline\" | \"giscus\" | \"twikoo\" | \"none\";\n  },\n): void => {\n  // v2 changes\n  if (\"type\" in options) {\n    logger.warn(\n      `${colors.magenta(\n        \"iconComponent\",\n      )} is deprecated, please use ${colors.magenta(\"provider\")}.`,\n    );\n    if (options[\"type\"] === \"waline\") options.provider = \"Waline\";\n    else if (options[\"type\"] === \"giscus\") options.provider = \"Giscus\";\n    else if (options[\"type\"] === \"twikoo\") options.provider = \"Twikoo\";\n\n    delete options[\"type\"];\n  }\n\n  // convert Waline options\n  if (options.provider === \"Waline\") {\n    [\n      // valine\n      [\"emojiCDN\", \"emoji\"],\n      [\"emojiMaps\", \"emoji\"],\n      [\"requiredFields\", \"requiredMeta\"],\n      [\"visitor\", \"pageview\"],\n      [\"langMode\", \"locale\"],\n      [\"placeholder\", \"locale.placeholder\"],\n\n      // waline v1\n      [\"anonymous\", \"login\"],\n      [\"copyRight\", \"copyright\"],\n    ].forEach(([oldOptions, newOptions]) => {\n      if (oldOptions in options) {\n        logger.warn(\n          `\"${colors.magenta(\n            oldOptions,\n          )}\" is deprecated in @waline/client@v2, you should use \"${colors.magenta(\n            newOptions,\n          )}\" instead.`,\n        );\n\n        // @ts-ignore\n        delete options[oldOptions];\n      }\n    });\n\n    [\n      // valine\n      \"region\",\n      \"appId\",\n      \"appKey\",\n      \"notify\",\n      \"verify\",\n      \"avatar\",\n      \"avatarForce\",\n      \"enableQQ\",\n      \"recordIP\",\n      \"serverURLs\",\n\n      // waline v1\n      \"avatarCDN\",\n      \"mathTagSupport\",\n      \"highlight\",\n      \"uploadImage\",\n      \"previewMath\",\n    ].forEach((option) => {\n      if (option in options) {\n        logger.error(\n          `\"${colors.magenta(\n            option,\n          )}\" is no longer supported in @waline/client@v2.`,\n        );\n\n        // @ts-expect-error\n        delete options[option];\n      }\n    });\n  }\n};\n","import type { PluginFunction } from \"@vuepress/core\";\nimport { useSassPalettePlugin } from \"vuepress-plugin-sass-palette\";\nimport {\n  addCustomElement,\n  addViteOptimizeDepsExclude,\n  addViteOptimizeDepsInclude,\n  addViteSsrExternal,\n  addViteSsrNoExternal,\n  checkVersion,\n  getLocales,\n} from \"vuepress-shared/node\";\n\nimport { getProvider } from \"./alias.js\";\nimport { convertOptions } from \"./compact.js\";\nimport { walineLocales } from \"./locales.js\";\nimport type { CommentPluginOptions } from \"./options.js\";\nimport {\n  CLIENT_FOLDER,\n  PLUGIN_NAME,\n  getPackage,\n  isInstalled,\n  logger,\n} from \"./utils.js\";\n\n/** Comment Plugin */\nexport const commentPlugin =\n  (options: CommentPluginOptions, legacy = true): PluginFunction =>\n  (app) => {\n    // TODO: Remove this in v2 stable\n    if (legacy)\n      convertOptions(options as CommentPluginOptions & Record<string, unknown>);\n    checkVersion(app, PLUGIN_NAME, \"2.0.0-beta.67\");\n\n    if (app.env.isDebug) logger.info(\"Options:\", options);\n\n    const pkg = getPackage(options.provider);\n\n    if (pkg && !isInstalled(pkg)) {\n      logger.error(\n        `Package ${pkg} is not installed, please install it manually!`,\n      );\n\n      return { name: PLUGIN_NAME };\n    }\n\n    const userWalineLocales =\n      options.provider === \"Waline\"\n        ? getLocales({\n            app,\n            name: \"waline\",\n            default: walineLocales,\n            config: options.locales,\n          })\n        : {};\n\n    // remove locales so that they won’t be injected in client twice\n    if (options.provider === \"Waline\" && \"locales\" in options)\n      delete options.locales;\n\n    useSassPalettePlugin(app, { id: \"hope\" });\n\n    return {\n      name: PLUGIN_NAME,\n\n      alias: {\n        [`${PLUGIN_NAME}/provider`]: getProvider(options.provider),\n      },\n\n      define: () => ({\n        COMMENT_OPTIONS: options,\n        ...(options.provider === \"Waline\"\n          ? {\n              WALINE_LOCALES: userWalineLocales,\n              WALINE_META: options.metaIcon !== false,\n            }\n          : {}),\n      }),\n\n      extendsBundlerOptions: (bundlerOptions: unknown, app): void => {\n        switch (options.provider) {\n          case \"Artalk\": {\n            addViteOptimizeDepsExclude(\n              bundlerOptions,\n              app,\n              \"artalk/dist/Artalk.es.js\",\n            );\n            addViteSsrExternal(bundlerOptions, app, \"artalk\");\n            break;\n          }\n\n          case \"Giscus\": {\n            addCustomElement(bundlerOptions, app, \"GiscusWidget\");\n            addViteSsrExternal(bundlerOptions, app, \"giscus\");\n            break;\n          }\n\n          case \"Waline\": {\n            addViteOptimizeDepsInclude(bundlerOptions, app, \"autosize\");\n            addViteOptimizeDepsExclude(bundlerOptions, app, \"@waline/client\");\n            addViteSsrExternal(bundlerOptions, app, \"@waline/client\");\n            break;\n          }\n\n          case \"Twikoo\": {\n            addViteOptimizeDepsInclude(bundlerOptions, app, \"twikoo\");\n            addViteSsrExternal(bundlerOptions, app, \"twikoo\");\n            break;\n          }\n        }\n\n        addViteSsrNoExternal(bundlerOptions, app, \"vuepress-shared\");\n      },\n\n      clientConfigFile: `${CLIENT_FOLDER}config.js`,\n    };\n  };\n"],"names":["walineLocales","__dirname","getDirname","require","createRequire","CLIENT_FOLDER","ensureEndingSlash","path","COMMENT_PROVIDERS","PLUGIN_NAME","logger","Logger","getPackage","provider","isInstalled","pkg","getProvider","noopModule","convertOptions","options","colors","oldOptions","newOptions","option","commentPlugin","legacy","app","checkVersion","userWalineLocales","getLocales","useSassPalettePlugin","bundlerOptions","addViteOptimizeDepsExclude","addViteSsrExternal","addCustomElement","addViteOptimizeDepsInclude","addViteSsrNoExternal"],"mappings":"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"}